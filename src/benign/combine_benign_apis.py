import pickle

import pandas as pd

if __name__ == '__main__':

    # 去重后添加排序的 apis，这里和malicious不同的是直接操作pickle文件，而不是重新从应用中获取。
    sorted_apis_benign = []
    # 所有应用对应的 apis，二维数组，数组的个数就是应用的个数
    benign_apis = [[]]
    final_unique_apis = []

    with open('../../saved_items/benign_api_calls_dict.pickle', 'rb') as handle:
        sorted_apis_benign = pickle.load(handle)

    with open('../../saved_items/benign_apis_list.pickle', 'rb') as handle:
        benign_apis = pickle.load(handle)

    print("sorted_apis_benign:", sorted_apis_benign)
    print("benign_permissions:", benign_apis)

    for key in sorted_apis_benign:
        final_unique_apis.append(key[0])

    # final_unique_apis 是最终的 permissions 包含malicious和benign
    # print(final_unique_apis)
    print(len(sorted_apis_benign))

    df = pd.DataFrame(columns=final_unique_apis)

    print(df.shape)

    count = 0
    for apk_apis in benign_apis:
        row = [0 for _ in final_unique_apis]
        for api in apk_apis:
            index = final_unique_apis.index(api)
            row[index] = 1
        df.loc[count] = row
        count += 1
        # todo test
        if count > 2:
            break

    print(df.shape)

    # df.insert(0, "type", 0)
    df.to_csv('../../csv/all_benign_apis.csv')

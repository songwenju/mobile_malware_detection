import pandas as pd
import numpy as np
import pickle
import warnings
from sklearn.feature_selection import SelectKBest
from sklearn.feature_selection import chi2

from src.Constant import FINAL_FEATURE_SIZE, final_training_set_csv, selected_features_CHI2_pick

warnings.filterwarnings("ignore")


# 卡方统计

def selected_features_CHI2():
    df = pd.read_csv(final_training_set_csv, index_col=0)
    names = list(df.columns.values)
    selected_features_CHI2 = set()
    X = np.array(df.drop(['type'], 1))
    y = np.array(df['type'])
    model = SelectKBest(chi2, k=FINAL_FEATURE_SIZE)
    model.fit_transform(X, y)
    for index in model.get_support(True):
        selected_features_CHI2.add(names[index])

    # for value in selected_features_CHI2:
    #     print(value)

    with open(selected_features_CHI2_pick, 'wb') as handle:
        pickle.dump(selected_features_CHI2, handle)


if __name__ == '__main__':
    selected_features_CHI2()

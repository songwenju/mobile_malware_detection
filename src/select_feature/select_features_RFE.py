import pickle
import warnings
import pandas as pd
import numpy as np
from sklearn.feature_selection import RFE
from sklearn.linear_model import LogisticRegression

from src.Constant import FINAL_FEATURE_SIZE, final_training_set_csv, selected_features_LR_pick

warnings.filterwarnings("ignore")


# 递归特征消除（RFE）
# 递归特征消除的主要思想是反复构建模型，每次从当前的一组特征中删除最不重要的特征，然后对该过程进行递归重复，直到最终达到所需的特征数量
def select_feature_RFE():
    df = pd.read_csv(final_training_set_csv, index_col=0)
    names = list(df.columns.values)
    selected_features_LR = set()
    X = np.array(df.drop(['type'], 1))
    print(X)
    y = np.array(df['type'])

    model = LogisticRegression()
    # 保留FINAL_FEATURE_SIZE个特征
    rfe = RFE(model, FINAL_FEATURE_SIZE)
    fit = rfe.fit(X, y)
    index = 0
    for value in fit.support_:
        if value:
            selected_features_LR.add(names[index])

        index = index + 1

    with open(selected_features_LR_pick, 'wb') as handle:
        pickle.dump(selected_features_LR, handle)

    # 保留的特征为True
    print("Selected Features:", fit.support_)
    # 保留的特征等级为1
    print("Feature Ranking:", fit.ranking_)
    print("selected_features_LR:", selected_features_LR)


if __name__ == '__main__':
    select_feature_RFE()

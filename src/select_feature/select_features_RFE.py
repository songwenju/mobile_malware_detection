import pickle
import warnings
import pandas as pd
import numpy as np
from sklearn.feature_selection import RFE
from sklearn.linear_model import LogisticRegression

from src.Constant import FINAL_FEATURE_SIZE

warnings.filterwarnings("ignore")


# 递归特征消除（RFE）
# 递归特征消除的主要思想是反复构建模型，每次从当前的一组特征中删除最不重要的特征，然后对该过程进行递归重复，直到最终达到所需的特征数量
def select_feature_RFE():
    df = pd.read_csv(r'../../csv/final_training_set.csv', index_col=0)

    X = np.array(df.drop(['type'], 1))
    print(X)
    y = np.array(df['type'])

    model = LogisticRegression()
    # 保留FINAL_FEATURE_SIZE个特征
    rfe = RFE(model, FINAL_FEATURE_SIZE)
    fit = rfe.fit(X, y)

    with open(r'../../saved_items/selected_features_LR.pickle', 'wb') as handle:
        pickle.dump(fit.support_, handle)

    # 保留的特征为True
    print("Selected Features:", fit.support_)
    # 保留的特征等级为1
    print("Feature Ranking:", fit.ranking_)


if __name__ == '__main__':
    select_feature_RFE()

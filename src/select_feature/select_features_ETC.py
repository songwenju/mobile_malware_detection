import pandas as pd
import numpy as np
import pickle
import warnings
from sklearn.ensemble import ExtraTreesClassifier
from sklearn.feature_selection import SelectKBest
from sklearn.feature_selection import chi2

from src.Constant import FINAL_FEATURE_SIZE

warnings.filterwarnings("ignore")

# ExtRa Trees是Extremely Randomized Trees的缩写，意思就是极度随机树。这是一种组合方法，与其说像决策树，实际上它更像随机森林。
#
if __name__ == '__main__':

    df = pd.read_csv(r'../../csv/final_training_set.csv', index_col=0)
    names = list(df.columns.values)

    selected_features_ETC = set()

    from sklearn.ensemble import ExtraTreesClassifier

    X = np.array(df.drop(['type'], 1))
    y = np.array(df['type'])

    etclf = ExtraTreesClassifier()
    etclf.fit(X, y)
    feature_importance = etclf.feature_importances_
    feature_importance_index = feature_importance.argsort()  # 元素的索引，越往后，索引对应的元素越大
    keep_features = feature_importance_index[-FINAL_FEATURE_SIZE:]

    for value in keep_features:
        selected_features_ETC.add(names[value])
        print(names[value])

    with open(r'../../saved_items/selected_features_ETC.pickle', 'wb') as handle:
        pickle.dump(selected_features_ETC, handle)

import pandas as pd
import numpy as np
import pickle
import warnings

from src.Constant import FINAL_FEATURE_SIZE, final_training_set_csv, selected_features_ETC_pick

warnings.filterwarnings("ignore")


# ExtRa Trees是Extremely Randomized Trees的缩写，意思就是极度随机树。这是一种组合方法，与其说像决策树，实际上它更像随机森林。


def selected_features_ETC():
    df = pd.read_csv(final_training_set_csv, index_col=0)
    names = list(df.columns.values)

    selected_features_ETC = set()

    from sklearn.ensemble import ExtraTreesClassifier

    X = np.array(df.drop(['type'], 1))
    y = np.array(df['type'])

    etclf = ExtraTreesClassifier()
    etclf.fit(X, y)
    feature_importance = etclf.feature_importances_
    feature_importance_index = feature_importance.argsort()  # 元素的索引，越往后，索引对应的元素越大
    keep_features = feature_importance_index[-FINAL_FEATURE_SIZE:]

    for value in keep_features:
        selected_features_ETC.add(names[value])
        print(names[value])

    with open(selected_features_ETC_pick, 'wb') as handle:
        pickle.dump(selected_features_ETC, handle)


if __name__ == '__main__':
    selected_features_ETC()

import pickle
import re

import pandas as pd

split_perms_refined = []


# 提纯 train
def refine(spl):
    split_rows_refined = []
    for data in spl:
        data = re.sub("['\[\] ]", '', data)
        split_rows_refined.append(data)
    return split_rows_refined


permissions = {}
api_calls = {}

with open('saved_items/malicious_permissions_dict.pickle', 'rb') as handle:
    permissions = pickle.load(handle)

with open('saved_items/malicious_api_calls_dict.pickle', 'rb') as handle:
    api_calls = pickle.load(handle)

print('total ' + str(len(permissions)) + ' permissions')

print('total ' + str(len(api_calls)) + ' api_calls')

df = pd.read_csv(r"csv/train.csv")

perms = str(df.columns.values)

split_perms = perms.split(';')

for perm in split_perms:
    perm = re.sub("['\[\] ]", '', perm)
    split_perms_refined.append(perm)

df2 = pd.DataFrame(columns=split_perms_refined)

for index, row in df.iterrows():
    value = str(row.values)
    spl = value.split(';')
    refined = refine(spl)
    df2.loc[index] = refined

df2.to_csv('refined_training.csv')

df = pd.read_csv(r"csv\refined_training.csv")

perms = (df.columns.values)
